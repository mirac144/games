<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NÖRO-GRID: Çekirdek Kararsızlığı</title>
    <style>
        /* --- CORE STYLES & CRT EFFECT --- */
        :root {
            --bg-color: #050505;
            --grid-off: #1a1a1a;
            --neon-green: #0f0;
            --neon-red: #f00;
            --neon-blue: #0ff;
            --screen-overlay: rgba(18, 16, 16, 0.1);
        }

        @font-face {
            font-family: 'Pixel';
            src: local('Courier New'); /* Fallback */
        }

        body {
            margin: 0;
            background-color: var(--bg-color);
            color: var(--neon-green);
            font-family: 'Courier New', Courier, monospace;
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            user-select: none;
        }

        /* CRT Tarama Çizgisi Efekti */
        .scanlines {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(
                to bottom,
                rgba(255,255,255,0),
                rgba(255,255,255,0) 50%,
                rgba(0,0,0,0.2) 50%,
                rgba(0,0,0,0.2)
            );
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 999;
        }
        
        /* Ekran Titreme Efekti */
        .flicker {
            animation: flicker 0.15s infinite;
        }

        @keyframes flicker {
            0% { opacity: 0.9; }
            50% { opacity: 1.0; }
            100% { opacity: 0.95; }
        }

        /* --- UI LAYOUT --- */
        .container {
            width: 100%;
            max-width: 600px;
            padding: 20px;
            text-align: center;
            border: 2px solid var(--neon-green);
            box-shadow: 0 0 20px var(--neon-green), inset 0 0 20px var(--neon-green);
            background: rgba(0, 20, 0, 0.8);
            position: relative;
            z-index: 10;
        }

        h1 {
            margin: 0 0 20px 0;
            text-transform: uppercase;
            text-shadow: 2px 2px var(--neon-red);
            font-size: 2rem;
            letter-spacing: 5px;
        }

        .hidden { display: none !important; }

        /* --- BUTTONS --- */
        .cyber-btn {
            background: black;
            color: var(--neon-green);
            border: 1px solid var(--neon-green);
            padding: 15px 30px;
            margin: 10px;
            font-family: inherit;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            transition: 0.2s;
            box-shadow: 0 0 5px var(--neon-green);
        }

        .cyber-btn:hover {
            background: var(--neon-green);
            color: black;
            box-shadow: 0 0 15px var(--neon-green);
        }

        .btn-danger {
            border-color: var(--neon-red);
            color: var(--neon-red);
            box-shadow: 0 0 5px var(--neon-red);
        }
        .btn-danger:hover {
            background: var(--neon-red);
            color: black;
            box-shadow: 0 0 15px var(--neon-red);
        }

        /* --- GAME GRID --- */
        .game-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin: 20px auto;
            max-width: 400px;
            aspect-ratio: 1;
        }

        .cell {
            background-color: var(--grid-off);
            border: 1px solid #333;
            cursor: pointer;
            transition: background-color 0.1s;
            position: relative;
        }

        .cell:active {
            transform: scale(0.95);
        }

        /* Hücre Durumları */
        .cell.active {
            background-color: var(--neon-red);
            box-shadow: 0 0 15px var(--neon-red);
            border-color: #fff;
        }

        .cell.correct {
            background-color: var(--neon-green) !important;
            transition: 0.1s;
        }
        
        .cell.wrong {
            background-color: #fff !important; /* Flash */
        }

        /* --- HUD --- */
        .hud {
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid var(--neon-green);
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 1.2rem;
        }

        .bar-container {
            width: 100%;
            height: 10px;
            background: #333;
            margin-top: 5px;
            position: relative;
        }

        .health-bar {
            width: 100%;
            height: 100%;
            background: var(--neon-green);
            transition: width 0.2s, background 0.2s;
        }

        /* --- LEADERBOARD --- */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #333;
            padding: 8px;
            text-align: left;
        }
        th { color: var(--neon-blue); }
        
        input[type="text"] {
            background: black;
            border: 1px solid var(--neon-green);
            color: var(--neon-green);
            padding: 10px;
            font-family: inherit;
            width: 60%;
            text-align: center;
            font-size: 1.2rem;
        }

    </style>
</head>
<body>

    <div class="scanlines"></div>

    <div class="container flicker">
        
        <!-- MENU EKRANI -->
        <div id="screen-menu">
            <h1>Nöro-Grid v1.0</h1>
            <p style="font-size: 0.8rem; opacity: 0.7;">> SİSTEM DURUMU: BEKLİYOR...</p>
            <p style="font-size: 0.8rem; opacity: 0.7;">> GÖREV: KIRMIZI HÜCRELERİ STABİLİZE ET</p>
            <br>
            <button class="cyber-btn" onclick="game.start('survival')">MODE: MELTDOWN (Sonsuz)</button>
            <button class="cyber-btn" onclick="game.start('blitz')">MODE: DATA BLITZ (50 Hata)</button>
            <br><br>
            <button class="cyber-btn btn-danger" onclick="ui.showLeaderboard()">// VERİTABANI</button>
        </div>

        <!-- OYUN EKRANI -->
        <div id="screen-game" class="hidden">
            <div class="hud">
                <span id="hud-mode">MOD: ???</span>
                <span id="hud-score">SKOR: 0000</span>
            </div>
            
            <div id="health-container">
                <div style="display:flex; justify-content:space-between; font-size:0.8rem;">
                    <span>ÇEKİRDEK KARARLILIĞI</span>
                    <span id="health-text">100%</span>
                </div>
                <div class="bar-container">
                    <div id="health-bar" class="health-bar"></div>
                </div>
            </div>

            <div class="game-grid" id="grid">
                <!-- 25 Hücre JS ile gelecek -->
            </div>
            <p id="message-log" style="font-size: 0.8rem; min-height: 1.2rem; color: var(--neon-blue);">> BAŞLATILIYOR...</p>
        </div>

        <!-- SONUÇ EKRANI -->
        <div id="screen-result" class="hidden">
            <h1 style="color: var(--neon-red);">SİSTEM ÇÖKTÜ</h1>
            <p id="result-reason">Çekirdek Eridi.</p>
            
            <div style="font-size: 3rem; margin: 20px 0; text-shadow: 0 0 10px white;" id="final-score">
                0
            </div>

            <input type="text" id="player-name" placeholder="KOD ADINI GİR" maxlength="10" autocomplete="off">
            <br><br>
            <button class="cyber-btn" onclick="game.saveScore()">KAYDET & ÇIKIŞ</button>
            <button class="cyber-btn btn-danger" onclick="ui.showMenu()">İPTAL</button>
        </div>

        <!-- SKOR TABLOSU -->
        <div id="screen-leaderboard" class="hidden">
            <h2>> EN İYİ OPERATÖRLER</h2>
            <div style="margin-bottom: 15px;">
                <button class="cyber-btn" style="font-size:0.8rem; padding:5px 10px;" onclick="ui.renderScores('survival')">Meltdown</button>
                <button class="cyber-btn" style="font-size:0.8rem; padding:5px 10px;" onclick="ui.renderScores('blitz')">Blitz</button>
            </div>
            <table id="score-table">
                <thead>
                    <tr><th>#</th><th>OP</th><th>VERİ</th></tr>
                </thead>
                <tbody id="score-body"></tbody>
            </table>
            <br>
            <button class="cyber-btn btn-danger" onclick="ui.showMenu()">GERİ</button>
        </div>

    </div>

    <script>
        /**
         * SES EFEKTLERİ (AudioContext kullanarak external dosya olmadan ses üretimi)
         */
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            const now = audioCtx.currentTime;

            if (type === 'hit') {
                // Yüksek, kısa bip (Başarılı)
                osc.type = 'square';
                osc.frequency.setValueAtTime(800, now);
                osc.frequency.exponentialRampToValueAtTime(1200, now + 0.1);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                osc.start(now);
                osc.stop(now + 0.1);
            } else if (type === 'spawn') {
                // Düşük tık (Yeni hedef)
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(200, now);
                gain.gain.setValueAtTime(0.05, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.05);
                osc.start(now);
                osc.stop(now + 0.05);
            } else if (type === 'damage') {
                // Kalın, uyumsuz ses (Hata/Hasar)
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, now);
                osc.frequency.linearRampToValueAtTime(50, now + 0.3);
                gain.gain.setValueAtTime(0.2, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
            }
        }

        /**
         * OYUN MANTIĞI
         */
        const game = {
            state: 'menu',
            mode: 'survival', // 'survival' veya 'blitz'
            score: 0,
            health: 100,
            gridSize: 25,
            activeCells: [], // {index, timerId, spawnedAt}
            spawnInterval: null,
            difficultyMultiplier: 1,
            gameStartTime: 0,

            // Ayarlar
            baseSpawnRate: 1000, // Başlangıçta kaç ms'de bir hücre yanacak
            cellLifeTime: 1500,  // Hücre ne kadar süre yanık kalır (tıklamazsan hasar verir)

            initGrid: function() {
                const grid = document.getElementById('grid');
                grid.innerHTML = '';
                for(let i=0; i<this.gridSize; i++) {
                    let cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.index = i;
                    // Mobilde "touchstart" daha hızlı tepki verir, PC'de "mousedown"
                    cell.addEventListener('mousedown', (e) => this.handleInput(i, e)); 
                    grid.appendChild(cell);
                }
            },

            start: function(selectedMode) {
                this.mode = selectedMode;
                this.state = 'playing';
                this.score = 0;
                this.health = 100;
                this.activeCells = [];
                this.difficultyMultiplier = 1;
                this.gameStartTime = Date.now();

                this.initGrid();
                ui.showScreen('screen-game');
                ui.updateHealth(100);
                
                document.getElementById('hud-mode').innerText = this.mode === 'survival' ? 'MOD: MELTDOWN' : 'MOD: BLITZ';
                document.getElementById('message-log').innerText = '> SİSTEM BAŞLATILDI. HAZIR OL.';

                // Blitz Modu: Sağlık barı "İlerleme" barına dönüşür
                if(this.mode === 'blitz') {
                    document.getElementById('health-text').innerText = "Kalan: 50";
                    ui.updateHealth(100, true); // Mavi renk
                } else {
                    document.getElementById('health-text').innerText = "100%";
                }

                this.nextLoop();
            },

            nextLoop: function() {
                if(this.state !== 'playing') return;

                // Zorluk Artışı (Survival için)
                if(this.mode === 'survival') {
                    // Her 5 skorda bir hızlan
                    let speed = Math.max(300, this.baseSpawnRate - (this.score * 15));
                    this.spawnInterval = setTimeout(() => {
                        this.activateRandomCell();
                        this.nextLoop();
                    }, speed);
                } else {
                    // Blitz için sabit ama hızlı
                    this.spawnInterval = setTimeout(() => {
                        // Aynı anda birden fazla çıkabilir
                        this.activateRandomCell();
                        if(Math.random() > 0.7) this.activateRandomCell(); 
                        this.nextLoop();
                    }, 400);
                }
            },

            activateRandomCell: function() {
                if(this.state !== 'playing') return;

                // Dolu olmayan hücreleri bul
                const cells = document.querySelectorAll('.cell');
                const availableIndices = [];
                cells.forEach((c, i) => {
                    if(!c.classList.contains('active')) availableIndices.push(i);
                });

                if(availableIndices.length === 0) return; // Yer yok

                const randomIndex = availableIndices[Math.floor(Math.random() * availableIndices.length)];
                const cell = cells[randomIndex];

                cell.classList.add('active');
                playSound('spawn');

                // Hücrenin ömrü (Zorlaştıkça kısalır)
                let lifeTime = this.mode === 'survival' 
                    ? Math.max(600, this.cellLifeTime - (this.score * 10)) 
                    : 1500;

                const timerId = setTimeout(() => {
                    this.handleTimeout(randomIndex);
                }, lifeTime);

                this.activeCells.push({ index: randomIndex, timerId: timerId });
            },

            handleInput: function(index, event) {
                if(this.state !== 'playing') return;
                
                // ActiveCells dizisinde bu index var mı?
                const activeIndex = this.activeCells.findIndex(x => x.index === index);
                const cell = document.querySelectorAll('.cell')[index];

                if(activeIndex !== -1) {
                    // BAŞARILI VURUŞ
                    clearTimeout(this.activeCells[activeIndex].timerId);
                    this.activeCells.splice(activeIndex, 1);
                    
                    cell.classList.remove('active');
                    cell.classList.add('correct');
                    setTimeout(() => cell.classList.remove('correct'), 100);
                    
                    this.score++;
                    playSound('hit');
                    
                    document.getElementById('hud-score').innerText = 'SKOR: ' + this.score;

                    if(this.mode === 'blitz') {
                        let remaining = 50 - this.score;
                        document.getElementById('health-text').innerText = "Kalan: " + Math.max(0, remaining);
                        let percent = (remaining / 50) * 100;
                        document.getElementById('health-bar').style.width = percent + '%';
                        
                        if(this.score >= 50) this.gameOver(true); // Kazandın
                    }

                } else {
                    // YANLIŞ TIKLAMA (Ceza)
                    cell.classList.add('wrong');
                    setTimeout(() => cell.classList.remove('wrong'), 100);
                    this.takeDamage(5); // 5 hasar
                    document.getElementById('message-log').innerText = '> DİKKAT: YANLIŞ PROTOKOL!';
                }
            },

            handleTimeout: function(index) {
                if(this.state !== 'playing') return;

                // Zaman doldu, hücre hala aktifse hasar ver
                const activeIndex = this.activeCells.findIndex(x => x.index === index);
                if(activeIndex !== -1) {
                    this.activeCells.splice(activeIndex, 1);
                    const cell = document.querySelectorAll('.cell')[index];
                    cell.classList.remove('active');
                    
                    this.takeDamage(15); // Zaman aşımı daha çok hasar verir
                    document.getElementById('message-log').innerText = '> UYARI: HÜCRE STABİLİTESİ KAYBEDİLDİ!';
                }
            },

            takeDamage: function(amount) {
                if(this.mode === 'blitz') return; // Blitz modunda can gitmez (Sadece süre önemli)

                this.health -= amount;
                ui.updateHealth(this.health);
                playSound('damage');

                // Ekran sallanma efekti
                document.querySelector('.container').style.transform = `translate(${Math.random()*10-5}px, ${Math.random()*10-5}px)`;
                setTimeout(() => document.querySelector('.container').style.transform = 'translate(0,0)', 50);

                if(this.health <= 0) {
                    this.gameOver(false);
                }
            },

            gameOver: function(victory) {
                this.state = 'gameover';
                clearTimeout(this.spawnInterval);
                this.activeCells.forEach(ac => clearTimeout(ac.timerId));

                ui.showScreen('screen-result');

                let finalVal = 0;
                let reason = "";

                if(this.mode === 'survival') {
                    finalVal = this.score;
                    reason = "ÇEKİRDEK ERİMESİ GERÇEKLEŞTİ.";
                    document.querySelector('#screen-result h1').innerText = "SİSTEM ÇÖKTÜ";
                    document.querySelector('#screen-result h1').style.color = "var(--neon-red)";
                } else {
                    // Blitz modu skoru süredir
                    let timeTaken = (Date.now() - this.gameStartTime) / 1000;
                    finalVal = timeTaken.toFixed(2) + "s";
                    this.score = parseFloat(timeTaken.toFixed(2)); // Sıralama için
                    reason = "VERİ YÜKLEME TAMAMLANDI.";
                    document.querySelector('#screen-result h1').innerText = "GÖREV BAŞARILI";
                    document.querySelector('#screen-result h1').style.color = "var(--neon-blue)";
                }

                document.getElementById('final-score').innerText = finalVal;
                document.getElementById('result-reason').innerText = reason;
            },

            saveScore: function() {
                const name = document.getElementById('player-name').value.trim() || "Bilinmeyen";
                let allScores = JSON.parse(localStorage.getItem('neuroGridScores')) || {};
                
                if(!allScores[this.mode]) allScores[this.mode] = [];

                allScores[this.mode].push({
                    name: name,
                    score: this.score,
                    date: new Date().toLocaleDateString()
                });

                // Sıralama Mantığı
                if(this.mode === 'survival') {
                    // Yüksek skor iyi
                    allScores[this.mode].sort((a,b) => b.score - a.score);
                } else {
                    // Düşük süre iyi (Blitz)
                    allScores[this.mode].sort((a,b) => a.score - b.score);
                }

                allScores[this.mode] = allScores[this.mode].slice(0, 5); // İlk 5

                localStorage.setItem('neuroGridScores', JSON.stringify(allScores));
                ui.showLeaderboard();
            }
        };

        /**
         * ARAYÜZ YÖNETİMİ
         */
        const ui = {
            showScreen: function(id) {
                document.getElementById('screen-menu').classList.add('hidden');
                document.getElementById('screen-game').classList.add('hidden');
                document.getElementById('screen-result').classList.add('hidden');
                document.getElementById('screen-leaderboard').classList.add('hidden');
                
                document.getElementById(id).classList.remove('hidden');
            },
            
            showMenu: function() {
                this.showScreen('screen-menu');
            },

            updateHealth: function(val, isBlue = false) {
                const bar = document.getElementById('health-bar');
                if(val < 0) val = 0;
                bar.style.width = val + '%';
                
                if(isBlue) {
                    bar.style.backgroundColor = 'var(--neon-blue)';
                    return;
                }

                document.getElementById('health-text').innerText = Math.ceil(val) + "%";
                
                // Renk değişimi
                if(val > 50) bar.style.backgroundColor = 'var(--neon-green)';
                else if(val > 25) bar.style.backgroundColor = 'orange';
                else bar.style.backgroundColor = 'var(--neon-red)';
            },

            showLeaderboard: function() {
                this.showScreen('screen-leaderboard');
                this.renderScores('survival');
            },

            renderScores: function(mode) {
                const tbody = document.getElementById('score-body');
                tbody.innerHTML = '';
                const allScores = JSON.parse(localStorage.getItem('neuroGridScores')) || {};
                const list = allScores[mode] || [];

                if(list.length === 0) {
                    tbody.innerHTML = "<tr><td colspan='3'>VERİ BULUNAMADI</td></tr>";
                    return;
                }

                list.forEach((item, idx) => {
                    let s = mode === 'blitz' ? item.score + "s" : item.score;
                    let row = `<tr>
                        <td>${idx+1}</td>
                        <td style="color:white">${item.name}</td>
                        <td style="color:var(--neon-blue)">${s}</td>
                    </tr>`;
                    tbody.innerHTML += row;
                });
            }
        }
    </script>
</body>
</html>

