<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Milyon ParÃ§acÄ±k YÃ¼k Testi</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; display: flex; flex-direction: column; }
        canvas { display: block; }
        #controls {
            position: absolute;
            top: 0;
            left: 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.7);
            color: #fff;
            font-family: Arial, sans-serif;
            z-index: 100;
            border-bottom-right-radius: 10px;
        }
        #info {
            position: absolute;
            top: 10px;
            right: 10px;
            text-align: right;
            color: #ff0000;
            font-family: 'Courier New', monospace;
            font-size: 20px;
            z-index: 100;
            text-shadow: 0 0 10px #ff0000;
        }
        label, button { margin: 5px; }
        input[type="number"] { padding: 5px; width: 100px; }
        #start-button {
            background-color: #ff0000;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="controls">
        <label for="particleCount">ParÃ§acÄ±k SayÄ±sÄ± (Maks YÃ¼k Ä°Ã§in):</label>
        <input type="number" id="particleCount" value="50000" min="1000" step="1000">
        <button id="start-button" onclick="initializeSimulation()">BAÅžLAT/TEKRAR ET</button>
        <p style="font-size:12px; margin-top:10px;">**UYARI: YÃ¼ksek SayÄ±lar Sistemi Kilitleyebilir**</p>
    </div>
    <div id="info">YÃœK HAZIR</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        // --- Patlama ve Ayarlar ---
        let PARTICLE_COUNT = 50000; // BaÅŸlangÄ±Ã§ deÄŸeri
        const EXPLOSION_POWER = 150; // Patlama ÅŸiddeti (hÄ±z)
        const RANGE = 2000;
        const SHAKE_DURATION = 1.0;
        let shakeTime = 0;
        let isAnimated = false; // Animasyon dÃ¶ngÃ¼sÃ¼nÃ¼ kontrol etmek iÃ§in

        // --- Three.js DeÄŸiÅŸkenleri ---
        let scene, camera, renderer, particleSystem;
        let clock = new THREE.Clock();
        let velocities = [];
        let canvas = null;

        // Sayfa yÃ¼klendiÄŸinde render baÅŸlatÄ±lmaz, butona basÄ±lÄ±nca baÅŸlatÄ±lÄ±r.
        document.getElementById('particleCount').value = PARTICLE_COUNT;

        function initializeSimulation() {
            PARTICLE_COUNT = parseInt(document.getElementById('particleCount').value);
            const info = document.getElementById('info');
            const button = document.getElementById('start-button');
            
            // Mevcut kanvasÄ± ve sistemi temizle (Tekrar etme butonu iÃ§in)
            if (renderer) {
                renderer.dispose();
                document.body.removeChild(canvas);
                scene = null;
                particleSystem = null;
                canvas = null;
                velocities = [];
                isAnimated = false;
                shakeTime = 0;
            }

            button.disabled = true;
            button.textContent = 'YÃœKLENÄ°YOR...';
            info.textContent = `YÃœK: ${PARTICLE_COUNT} parÃ§acÄ±k`;

            // YÃ¼kleme sÃ¼reci uzun sÃ¼rebileceÄŸinden, kÄ±sa bir gecikmeyle baÅŸlatÄ±yoruz
            setTimeout(() => {
                init();
                startExplosion();
                // Animasyon dÃ¶ngÃ¼sÃ¼ sadece bir kez baÅŸlatÄ±lÄ±r
                if (!isAnimated) {
                    animate();
                    isAnimated = true;
                }
                button.disabled = false;
                button.textContent = 'TEKRAR PATLAT';
            }, 100);
        }

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 5000);
            camera.position.z = 1500;
            scene.add(new THREE.AmbientLight(0x444444)); 

            renderer = new THREE.WebGLRenderer({ antialias: false, powerPreference: "high-performance" });
            renderer.setSize(window.innerWidth, window.innerHeight);
            canvas = renderer.domElement;
            document.body.appendChild(canvas);

            // ParÃ§acÄ±k Verilerini HazÄ±rlama
            const geometry = new THREE.BufferGeometry();
            const positions = [];
            const colors = [];
            
            for (let i = 0; i < PARTICLE_COUNT; i++) {
                // Konum: Hepsi merkezde (0, 0, 0)
                positions.push(0, 0, 0);
                
                // HÄ±z: Rastgele baÅŸlangÄ±Ã§ hÄ±zÄ± yok
                velocities.push(0, 0, 0); 
                
                // Renk: Her parÃ§acÄ±ÄŸa rastgele (3D) bir renk ver (daha fazla GPU iÅŸi)
                const color = new THREE.Color(Math.random() * 0xffffff); 
                colors.push(color.r, color.g, color.b);
            }

            geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));

            const material = new THREE.PointsMaterial({
                size: 5, 
                vertexColors: true, 
                blending: THREE.AdditiveBlending,
                transparent: true,
                depthWrite: false 
            });

            particleSystem = new THREE.Points(geometry, material);
            scene.add(particleSystem);

            window.addEventListener('resize', onWindowResize, false);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        function startExplosion() {
            shakeTime = SHAKE_DURATION; 
            document.getElementById('info').textContent = `ðŸ’¥ PATLAMA BAÅžLADI! YÃ¼k: ${PARTICLE_COUNT}`;
            
            // KonumlarÄ± tekrar merkeze sÄ±fÄ±rla
            const posArray = particleSystem.geometry.attributes.position.array;
            for(let i = 0; i < posArray.length; i++) {
                 posArray[i] = 0;
            }

            // ParÃ§acÄ±klara radyal (merkezden dÄ±ÅŸarÄ± doÄŸru) baÅŸlangÄ±Ã§ hÄ±zÄ± ver
            for (let i = 0; i < velocities.length; i += 3) {
                // Rastgele birim vektÃ¶r oluÅŸtur (KÃ¼resel daÄŸÄ±lÄ±m)
                const phi = Math.random() * Math.PI * 2;
                const theta = Math.random() * Math.PI;

                const x = Math.sin(theta) * Math.cos(phi);
                const y = Math.sin(theta) * Math.sin(phi);
                const z = Math.cos(theta);

                // HÄ±z vektÃ¶rÃ¼nÃ¼ ayarla - Rastgelelik artÄ±rÄ±ldÄ±
                const speed = Math.random() * EXPLOSION_POWER * 2;
                velocities[i] = x * speed;     // vx
                velocities[i + 1] = y * speed; // vy
                velocities[i + 2] = z * speed; // vz
            }
            // KonumlarÄ±n gÃ¼ncellendiÄŸini WebGL'e bildir
            particleSystem.geometry.attributes.position.needsUpdate = true;
        }

        // --- Ana Animasyon DÃ¶ngÃ¼sÃ¼ (En YÃ¼klÃ¼ KÄ±sÄ±m) ---
        
        function animate() {
            requestAnimationFrame(animate);

            const delta = clock.getDelta();
            
            // ** YÃœKÃœ OLUÅžTURAN KISIM: Her Karede ParÃ§acÄ±k Hareketi **
            const positionAttribute = particleSystem.geometry.attributes.position;
            const posArray = positionAttribute.array;

            for (let i = 0; i < PARTICLE_COUNT; i++) {
                const index = i * 3;
                
                // 1. Yer Ã‡ekimi ve Hava Direnci (CPU)
                velocities[index + 1] -= 9.8 * delta * 10; // Daha hÄ±zlÄ± dÃ¼ÅŸÃ¼ÅŸ
                velocities[index] *= 0.999; 
                velocities[index + 2] *= 0.999;
                
                // 2. Konumu GÃ¼ncelle (CPU)
                posArray[index] += velocities[index] * delta; 
                posArray[index + 1] += velocities[index + 1] * delta; 
                posArray[index + 2] += velocities[index + 2] * delta;
                
                // 3. Ekstra YÃ¼k: Her adÄ±mda rastgele gÃ¼rÃ¼ltÃ¼ ekle (CPU'yu yorar)
                posArray[index] += (Math.random() - 0.5) * 15; 
                posArray[index + 1] += (Math.random() - 0.5) * 15;
                posArray[index + 2] += (Math.random() - 0.5) * 15;
                
                // 4. SÄ±nÄ±r KontrolÃ¼ ve YansÄ±ma
                if (posArray[index + 1] < -RANGE) {
                    velocities[index + 1] *= -0.8; // YansÄ±ma
                    posArray[index + 1] = -RANGE;
                }
            }

            positionAttribute.needsUpdate = true;
            
            // --- Ekran Sallanma Efekti ---
            if (shakeTime > 0) {
                const shakeIntensity = 100 * (shakeTime / SHAKE_DURATION); // Daha ÅŸiddetli sallanma

                camera.position.x += (Math.random() - 0.5) * shakeIntensity;
                camera.position.y += (Math.random() - 0.5) * shakeIntensity;
                
                shakeTime -= delta;
            } else {
                 // Kamera dÃ¼zeltme
                 const factor = delta * 5;
                 camera.position.x -= camera.position.x * factor;
                 camera.position.y -= camera.position.y * factor;
            }
            
            camera.lookAt(scene.position);
            renderer.render(scene, camera);
        }
        // JavaScript BitiÅŸi
    </script>
</body>
</html>
